<div class="dashboard">
<h1>DashBoard</h1>

<%# THIS CHECKS FOR THE ROLE OF THE CURRENT USER %>
<% if current_user.owner?  %>
<%# OWNERS DASHBOARD %>
<div class= "owner-dashboard" data-controller="toggle">
  <% @disasters.each do |disaster| %>
    <div class="disaster-card" data-controller="toggle">
    <%# DISASTER INFO %>
      <%= disaster.name %>
    <%# EDIT DISASTER BUTTON %>
      <button data-action="click->toggle#fire" class="btn btn-outline-secondary">
        Edit
      </button>

      <%# EDIT FORM POP UP FOR THIS DISASTER %>
      <div data-toggle-target="togglableElement" class="d-none">
        <%= simple_form_for disaster do |f| %>
          <%= f.input :disaster_type %>
          <%= f.input :name %>
          <%= f.input :location %>
          <%= f.input :intensity %>
          <%= f.input :price %>
          <%= f.input :description %>
          <%= f.submit "Update Disaster" %>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# BUTTON TO ADD A NEW DISASTER %>
  <button data-action="click->toggle#fire" class="btn btn-outline-primary">Add a new Disaster</button>
  <%# FORM FOR NEW DISASTER %>
  <div data-toggle-target="togglableElement" class="d-none">
    <%= simple_form_for @disaster do |f| %>
      <%= f.input :disaster_type %>
      <%= f.input :name %>
      <%= f.input :location %>
      <%= f.input :intensity %>
      <%= f.input :price %>
      <%= f.input :description %>
      <%= f.submit %>
    <% end %>
  </div>
</div>

<% else %>
<%# VISITORS DASHBOARD %>
    <div class="visitor-dashboard">
    <%# BOOKINGS INFO %>
      <h2>Your Bookings:</h2>
    <% @bookings.each do |booking| %>
    <div class="booking-card" data-controller="toggle">
      <h4><%= booking.disaster.name %></h4>
      <p><strong>Dates:</strong> <%= booking.start_date %> to <%= booking.end_date %></p>
      <p><strong>Location:</strong> <%= booking.disaster.location %></p>
      <%# BUTTON TO EDIT BOOKING %>
      <button data-action="click->toggle#fire" class="btn btn-outline-secondary">Edit Booking</button>
      <%# FORM TO UPDATE BOOKING %>
          <div data-toggle-target="togglableElement" class="d-none">
            <%= simple_form_for booking, html: { method: :patch } do |f| %>
              <%= f.input :start_date,
                        as: :string,
                        input_html: { data: { controller: "datepicker" } } %>
              <%= f.input :end_date,
                        as: :string,
                        input_html: { data: { controller: "datepicker" } } %>
              <%= f.submit "Update Booking" %>
            <% end %>
          </div>
          <div class="review-form" data-controller="toggle">
          <%# BUTTON & FORM TO ADD A REVIEW %>
            <button data-action="click->toggle#fire" class="btn btn-outline-primary">Add a review</button>
            <div data-toggle-target="togglableElement" class="d-none">
                <%= simple_form_for @review do |f| %>
                <%= f.hidden_field :booking_id, value: booking.id %>
                <%= f.input :comment %>
                <%= f.input :rating %>
                <%= f.submit %>
              <% end %>
            </div>
          </div>
        </div>
        <% end %>
    </div>
  <% end %>
</div>
